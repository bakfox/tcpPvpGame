# ğŸ° TowerDefense Project

<h3>Project - WebSocketì„ í™œìš©í•œ íƒ€ì›Œ ë””íœìŠ¤ ê²Œì„ ì„œë²„ êµ¬ì¶• </h3>

</br>

ì´ í”„ë¡œì íŠ¸ëŠ” Plants vs. Zombiesì™€ ê°™ì€ íƒ€ì›Œ ë””íœìŠ¤ ê²Œì„ìœ¼ë¡œ, í”Œë ˆì´ì–´ê°€ ë‹¤ì–‘í•œ íƒ€ì›Œë¥¼ ê²Œì„ ë§µì— ë°°ì¹˜í•´ ëª°ë ¤ì˜¤ëŠ” ì ë“¤ì„ ì „ëµì ìœ¼ë¡œ ë°©ì–´í•˜ëŠ” ê²Œì„ì…ë‹ˆë‹¤.<br><br>
ì„œë²„ëŠ” ê²Œì„ ìƒíƒœì™€ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, APIì™€ WebSocketì„ í†µí•´ íƒ€ì›Œ ê³µê²©, ì¿¨ë‹¤ìš´ ê³„ì‚°, ì ì˜ ì´ë™ ë“± ì£¼ìš” ê²Œì„ ë©”ì»¤ë‹ˆì¦˜ì„ ì²˜ë¦¬í•˜ë©°
í´ë¼ì´ì–¸íŠ¸ëŠ” ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤ì™€ ê°œì„ ëœ ë¹„ì£¼ì–¼ë¡œ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ë©°, ì˜¤ë¸Œì íŠ¸ì˜ ì´ë¯¸ì§€ë¥¼ ìƒˆë¡­ê²Œ ë””ìì¸í•´ ëª°ì…ê° ìˆëŠ” í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.<br>

</br>

### TowerDefense Game v1.0

> **TeamName: ë¶ˆ4ì¡°, ì‚¬**<br> > **1.0v : 2024.12.23 ~ 2025.01.02**</br>

<br>

|                                                   ì¡°ìƒìš°                                                    |
| :---------------------------------------------------------------------------------------------------------: |
| <image width="150px" src="https://github.com/user-attachments/assets/3b1aab86-19e0-4543-a753-dea39b233ca6"> |
|                                     [bakfox](https://github.com/bakfox)                                     |

<br/>

## ğŸ“• ì‹œì‘ ê°€ì´ë“œ

###

<h3>Requirements</h3>
For building and running the application you need:
 
 - Node.js 18.x
 - Npm 9.2.0
 - untiy 2022.3.22f1
 
<h3>Installation</h3>

```
$ git clone https://github.com/bakfox/towerDefense.git
$ cd towerDefense
```

#### Run Method

```
$ npm install
$ node src/app.js
```

---

<br>

## ğŸ“– Stacks

### Environment

![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=Visual%20Studio%20Code&logoColor=white)
![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white)
![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white)

### Config

![npm](https://img.shields.io/badge/npm-CB3837?style=for-the-badge&logo=npm&logoColor=white)

### Development

![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=Javascript&logoColor=white)
![HTML](https://img.shields.io/badge/HTML-E34F26?style=for-the-badge&logo=HTML&logoColor=white)
![Node.js](https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=Node.js&logoColor=white)
![Socket.io](https://img.shields.io/badge/Socket.io-010101?style=for-the-badge&logo=Socket.io&logoColor=white)
![MySQL](https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white)
![Prisma](https://img.shields.io/badge/Prisma-2D3748?style=for-the-badge&logo=Prisma&logoColor=white)
![AmazonRDS](https://img.shields.io/badge/AmazonRDS-527FFF?style=for-the-badge&logo=AmazonRDS&logoColor=white)
![AmazonEC2](https://img.shields.io/badge/AmazonEC2-FF9900?style=for-the-badge&logo=AmazonEC2&logoColor=white)

### Communication

![Slack](https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=Slack&logoColor=white)
![Notion](https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white)

---

</br>

## ğŸ“™ ë‹´ë‹¹ íŒŒíŠ¸ ë° ì „ë°˜ì ì¸ ê¸°íš

### ë‹´ë‹¹ íŒŒíŠ¸

- ì¡°ìƒìš° - ì œì‘!

## ğŸ•¹ï¸ ê²Œì„ ì˜ìƒ

(https://youtu.be/JwiP7sfFq28)

---

### í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ

[bakfox](https://github.com/bakfox/node7_unity_client)
<br>

<h3>ì¢€ë¹„ ìŠˆíŒ… ê²Œì„</h3>
<details>
## ì¸ ê²Œì„

### ì„œë²„ ê¸°ëŠ¥

1. ì´ë™

   - í´ë¼ì—ì„œ ë³´ë‚´ì£¼ëŠ” ë°©í–¥ì— ë§ê²Œ ì„œë²„ì—ì„œ ë°˜ë³µì„ ëŒë©° ì„œë²„ì—ì„œ ìœ„ì¹˜ë¥¼ ë³€ê²½í•´ ì¤Œ ( ì¶”ì¸¡í•­ë²• ì ìš©! )
   - ê²Œì„ì— ì°¸ì—¬í•œ ì‚¬ìš©ì ì¤‘ ìµœëŒ€ ë ˆì´í„´ì‹œ ê°’ì„ ë°›ì•„ì„œ ê³„ì‚°í–ˆë‹¤.
   - ë³€ê²½í•œ ìœ„ì¹˜ë¥¼ í´ë¼ì—ê²Œ ë³´ë‚´ì¤€ë‹¤.

   ```jsx
   	calculatePosition(latency, timestamp) {
   	const distance = this.defaultSpeed * latency;

   	if (this.nextX !== undefined) {
   		this.x = this.nextX;
   	}
   	if (this.nextY !== undefined) {
   		this.y = this.nextY;
   	}

   	this.nextX = this.x + distance * this.lookX;
   	this.nextY = this.y + distance * this.lookY;

   	this.lastUpdateTime = Date.now();

   	return {
   		x: this.nextX,
   		y: this.nextY,
   	};
   }//ì´ë™ ë¡œì§ ì½”ë“œì…ë‹ˆë‹¤!
   ```

2. ê³µê²©

   - ê³µê²© ë¡œì§ì€ í´ë¼ì—ì„œ ë§ˆìš°ìŠ¤ë¥¼ í´ë¦­í•˜ë©´ ì‹¤í–‰ë©ë‹ˆë‹¤!
   - ì•„ë˜ëŠ” ì´ì•Œ í’€ì„ ë§Œë“¤ ìë£Œ êµ¬ì¡°í˜•ì¸ íë¥¼ êµ¬í˜„í•œ ì½”ë“œì…ë‹ˆë‹¤.

   ```jsx
   class BulletQueue {
   	constructor() {
   		this.queue = [];
   	}

   	enqueue(bullet) {
   		this.queue.push(bullet);
   	}

   	dequeue() {
   		if (this.isEmpty()) {
   			return null;
   		}
   		return this.queue.shift();
   	}

   	isEmpty() {
   		return this.queue.length === 0;
   	}

   	size() {
   		return this.queue.length;
   	}

   	peek() {
   		if (this.isEmpty()) {
   			return null;
   		}
   		return this.queue[0];
   	}
   }
   export default BulletQueue;
   ```

   - ì•„ë˜ëŠ” ì‹¤ì§ˆì ì¸ gameClassì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ ì…ë‹ˆë‹¤.

   ```jsx
   const shotUpdateHandler = ({ socket, userId, payload }) => {
   	try {
   		const { gameId, z } = payload;
   		const gameSession = getGameSession(gameId);
   		if (!gameSession) {
   			throw new customError(
   				ErrorCodes.GAME_NOT_FOUND,
   				"ê²Œì„ ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"
   			);
   		}
   		const user = gameSession.getUser(userId);
   		if (!user) {
   			throw new customError(ErrorCodes.USER_NOT_FOUND, "ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
   		}
   		const radians = (z * Math.PI) / 180;

   		const latency = gameSession.getMaxLatency();

   		const distance = latency * user.defaultBullets * 10;

   		const directionX = Math.cos(radians);
   		const directionY = Math.sin(radians);

   		let targetX = user.x + directionX * distance;
   		let targetY = user.y + directionY * distance;

   		const lastVec = { x: targetX, y: targetY };

   		const bullet = gameSession.getBullet();
   		bullet.initialize(
   			user.defaultAtck,
   			z,
   			user.defaultBullets,
   			user.defaultBullets * 10,
   			lastVec,
   			{ x: user.x, y: user.y },
   			user.id
   		);
   		bullet.thisStatuse = 1;

   		gameSession.intervalManager.addBulletUpdate(
   			gameId,
   			gameSession.setAllBullet.bind(gameSession),
   			100
   		);
   	} catch (error) {
   		handlerError(socket, error);
   	}
   };

   export default shotUpdateHandler;
   ```

   - ë°˜ë³µë¬¸ì´ ì¤‘ë³µìœ¼ë¡œ ë“¤ì–´ê°€ëŠ”ê±´ intervalManagerìª½ì—ì„œ ê²€ì¦ì„ í•´ì„œ ë§‰ê³  ìˆìŠµë‹ˆë‹¤!
   - ì‹¤ì§ˆì ì¸ ì´ì•Œì˜ ì´ë™ì€ í”Œë ˆì´ì–´ì˜ ì´ë™ê³¼ ê°™ì€ ì›ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤! ( ì¶”ì¸¡í•­ë²• ì ìš©! )

3. ì´ëª¨í‹°ì½˜
   - ìš”ì²­ ë°›ì€ ì´ëª¨í‹°ì½˜ì˜ idì™€ ìœ ì € idë¥¼ ë‹¤ì‹œ ê²Œì„ ìƒˆì…˜ ì•ˆì—ìˆëŠ” ëª¨ë“  ìœ ì €ì—ê²Œ ë³´ëƒ…ë‹ˆë‹¤.

### í´ë¼ì´ì–¸íŠ¸ ê¸°ëŠ¥

1. ì´ë™
   - ì„œë²„ì—ì„œ ë³´ë‚´ì£¼ëŠ” ë°ì´í„°ì˜ ìœ„ì¹˜ë¡œ ì´ë™í•œë‹¤! ( ë³´ê°„ ì ìš©! )
2. ê³µê²©
   - í´ë¦­ ì‹œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ì„œ ì´ì•Œì˜ ìœ„ì¹˜ë¥¼ ë°›ì•„ì˜¨ë‹¤ ( ë³´ê°„ ì ìš©! )
3. ì´ëª¨í‹°ì½˜
   - Të¥¼ ëˆ„ë¥´ê³  ì›í•˜ëŠ” ì´ëª¨í‹°ì½˜ ìª½ìœ¼ë¡œ ê°€ì„œ í´ë¦­í•˜ë©´ ê·¸ ì´ëª¨í‹°ì½˜ì„ ì‚¬ìš©í•˜ê³  ëª¨ë‘ì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤!

### ê°€ì¥ í˜ë“¤ì—ˆë˜ ë¶€ë¶„.

- ê°€ì¥ ë†’ì€ ì§€ì—°ì‹œê°„ ì°¾ì•„ì£¼ëŠ” ì½”ë“œì…ë‹ˆë‹¤!

```jsx
// ìœ ì €ë“¤ì¤‘ ìµœê³  ë†’ì€ í•‘ ì°¾ê¸°!
	getMaxLatency() {
		let maxLatency = 1;
		this.users.forEach((user) => {
			maxLatency = Math.max(maxLatency, user.latency);
		});
		if (isNaN(maxLatency)) {
			maxLatency = 1;
		}
		return maxLatency;
	}
```

- ì´ê²Œ 0ì´ ë˜ì–´ ë²„ë¦¬ë©´ NaNì´ ë°œìƒí•´ì„œ ëª¨ë“  ì´ë™ ë¡œì§ì´ ë§ˆë¹„ê°€ ë©ë‹ˆë‹¤!
- ê·¸ë˜ì„œ ìµœì†Œ 1 ms ì„ ê¸°ë³¸ìœ¼ë¡œ ì¡ì•˜ìŠµë‹ˆë‹¤!
- ì´ê±° ì°¾ëŠ”ë° ì´í‹€ ì •ë„ ê±¸ë¦°ê±° ê°™ìŠµë‹ˆë‹¤!

- ì´ì•Œì˜ í˜„ì¬ ìœ„ì¹˜ë“¤ì„ ë³´ë‚´ì£¼ëŠ” packet ì…ë‹ˆë‹¤!

```jsx
// ìœ ì €ë“¤ì¤‘ ìµœê³  ë†’ì€ í•‘ ì°¾ê¸°!
export const createShotPacket = (data) => {
	const protoMessages = getProtoMessages();
	const Emoticon = protoMessages.gameNotification.ShotUpdate;
	const payload = data ? Buffer.from(JSON.stringify({ data })) : null;

	const message = Emoticon.create({ data: payload });
	const bulletPacket = Emoticon.encode(message).finish();
	return makeNotification(bulletPacket, PACKET_TYPE.BULLET_MOVE);
};
```

- ì´ê²Œ í´ë¼ì—ì„œ ë°›ì„ ë•Œ ì•„ì§ ë²„í¼ íƒ€ì…ì´ë¼ ë””ì½”ë“œë¥¼ í•œë²ˆ í•´ì¤˜ì•¼ í–ˆìŠµë‹ˆë‹¤!
- ê·¸ê±¸ ëª°ë¼ì„œ í•œì°¸ì„ ê³ ë¯¼í•˜ë‹¤ê°€ ê²¨ìš° ë„ì›€ì„ ë°›ì•„ì„œ í•´ê²°í–ˆìŠµë‹ˆë‹¤!
- ê·¸ë¦¬ê³  í´ë¼ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì„ ë•Œ dataë¥¼ ê·¸ëƒ¥ dataë¡œ ë°›ëŠ” ê²Œ ì•„ë‹ˆë¼ dataë¥¼ ê°ì‹¸ê³  ìˆëŠ” ê°ì²´ë¥¼ ë°›ì•„ì„œ ì‚¬ìš©í•˜ëŠ”ì§€ë¼ ì €ê¸° dataì—ë„ { data }ê°ì²´ë¡œ ê°ì‹¸ ì¥ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤!

- ë‚˜ë¨¸ì§€ëŠ” ì½”ë“œë¥¼ ë§Œë“  ì˜ë„ ëŒ€ë¡œ ì‹¤í–‰ë˜ì–´ì„œ í–‰ë³µí–ˆìŠµë‹ˆë‹¤!
- ì´ë²ˆì— ì½”ë“œë¥¼ í•˜ë©´ì„œ ì´ë ‡ê²Œ í•˜ë©´ ì´ë ‡ê²Œ ì‹¤í–‰í•  ê±°ë¼ëŠ” í™•ì‹ ì´ ì¢€ ë” ìƒê¸´ ê±° ê°™ìŠµë‹ˆë‹¤!
- ëŒ€ë¶€ë¶„ ë¬¸ì œëŠ” packetì´ë‚˜ payloadë¥¼ ì œëŒ€ë¡œ ëª» ë°›ìœ¼ë©´ì„œ ìƒê¸°ëŠ” ì¼ì´ ë§ì•˜ìŠµë‹ˆë‹¤!

</br>

<br>
